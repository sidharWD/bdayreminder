<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>🎉 Birthday Wishes!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        .balloon {
            animation: float 3s ease-in-out infinite;
        }
        .balloon:nth-child(2) { animation-delay: 0.2s; }
        .balloon:nth-child(3) { animation-delay: 0.4s; }
        .balloon:nth-child(4) { animation-delay: 0.6s; }
        
        @keyframes sparkle {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }
        
        .shine {
            background: linear-gradient(90deg, #ff69b4, #ff1493, #ff69b4);
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @media (max-width: 640px) {
            .balloon { font-size: 3rem; }
            .sparkle { font-size: 2.5rem; }
        }

        /* Prevent text selection during taps on mobile */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Allow text selection in the message container */
        #wishMessageContainer {
            -webkit-user-select: text;
            user-select: text;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 min-h-screen flex flex-col items-center justify-center p-3 sm:p-4 relative overflow-hidden">
    <!-- Floating Balloons -->
    <div class="fixed top-0 left-0 w-full h-full pointer-events-none">
        <div class="balloon text-5xl sm:text-7xl absolute top-10 left-[5%] sm:left-[10%]">🎈</div>
        <div class="balloon text-5xl sm:text-7xl absolute top-20 right-[8%] sm:right-[15%]">🎈</div>
        <div class="balloon text-5xl sm:text-7xl absolute top-40 left-[12%] sm:left-[20%]">🎈</div>
        <div class="balloon text-5xl sm:text-7xl absolute top-30 right-[15%] sm:right-[25%]">🎈</div>
    </div>

    <div class="bg-white/90 backdrop-blur-md p-4 sm:p-8 rounded-2xl shadow-2xl w-full max-w-lg transform hover:scale-105 transition-transform duration-300 mx-3">
        <div class="relative">
            <h1 class="text-2xl sm:text-4xl font-bold text-center mb-4 sm:mb-6 shine p-3 sm:p-4 rounded-xl text-white">
                ✨ Birthday Celebration! ✨
            </h1>
            <span class="absolute -top-3 sm:-top-4 -right-2 sm:-right-4 text-3xl sm:text-4xl sparkle">🎂</span>
            <span class="absolute -top-3 sm:-top-4 -left-2 sm:-left-4 text-3xl sm:text-4xl sparkle">🎁</span>
        </div>

        <div id="ageDisplay" class="text-center text-xl sm:text-2xl font-bold text-purple-600 mb-3 sm:mb-4" style="display: none;">
            <!-- Age will appear here -->
        </div>

        <div id="wishMessageContainer" class="mt-6 sm:mt-8 relative">
            <div id="wishMessage"
                 class="text-center text-lg sm:text-xl text-gray-800 p-4 sm:p-6 rounded-xl min-h-[100px] sm:min-h-[120px] flex items-center justify-center transform transition-all duration-500"
                 style="display: none;">
                <!-- Wish will appear here -->
            </div>
            <div id="wishFrom" class="text-center text-base sm:text-lg text-pink-600 mt-3 sm:mt-4 font-medium" style="display: none;">
                <!-- From message will appear here -->
            </div>
        </div>

        
    </div>

    <a href="create_shareable_link.html" class="mt-4 sm:mt-6 text-white hover:text-pink-200 text-base sm:text-lg font-medium hover:underline transition-colors duration-300 flex items-center">
        <span class="mr-2">🎂</span> Create Your Birthday Link Here! <span class="ml-2">🎈</span>
    </a>

    <script>
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function getNextBirthday(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            const nextBirthday = new Date(today.getFullYear(), birth.getMonth(), birth.getDate());
            
            if (nextBirthday < today) {
                nextBirthday.setFullYear(today.getFullYear() + 1);
            }
            
            return nextBirthday;
        }

        function getDaysDifference(date1, date2) {
            const diffTime = Math.abs(date2 - date1);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        const todayWishes = [
            "✨ Happy {age}th Birthday, {name}! 🎉\nMay your day sparkle with joy, shimmer with laughter, and shine with everything that makes you happy!",
            "🌟 Wishing you, {name}, a magical {age}th birthday filled with dreams come true!\nMay this special day bring you endless happiness and sweet surprises!",
            "🎂 Happy {age}th Birthday, dear {name}! 🎈\nMay your day be as bright as your smile and as sweet as your heart!",
            "🎁 On your {age}th birthday, {name}!\nMay every moment be filled with the warmth of sunshine and the sparkle of starlight!",
            "🌈 Celebrating wonderful you, {name}, on your {age}th birthday! 🎊\nMay your day be sprinkled with fun and laughter, wrapped in warmth, and topped with love!"
        ];

        const upcomingWishes = [
            "🎈 Hey {name}! Only {days} days until your {age}th birthday! The countdown to your special day has begun! 🎉",
            "✨ {name}, get ready! Your {age}th birthday is just {days} days away! Can't wait to celebrate you! 🎂",
            "🌟 {days} days to go until we celebrate your {age}th birthday, {name}! The excitement is building! 🎊",
            "🎁 Mark your calendar, {name}! Your {age}th birthday arrives in {days} days! It's going to be amazing! ✨"
        ];

        const pastWishes = [
            "🌈 {name}, your {age}th year is going to be incredible! Hope you're still feeling the birthday magic! ✨",
            "🎁 {name}, {days} days into your {age}th year and you're already shining so bright! Keep spreading your joy! 🌟",
            "✨ {name}, you're {days} days into being {age}, and you're rocking it! Here's to many more amazing days! 🎉",
            "🎈 {name}, you've been {age} for {days} wonderful days! Keep embracing every moment with your beautiful smile! 🌺"
        ];

        const wishDisplay = document.getElementById('wishMessage');
        const wishMessageContainer = document.getElementById('wishMessageContainer');
        const wishFromDisplay = document.getElementById('wishFrom');
        const ageDisplay = document.getElementById('ageDisplay');

        function generateAndDisplayWish(name, birthDate, wishFrom) {
            if (!name || !birthDate) {
                wishDisplay.innerHTML = `
                    <div class="text-pink-600 font-semibold">
                        <span class="text-3xl mb-2 block">🎈</span>
                        Please use your special birthday link!
                        <span class="text-3xl mt-2 block">🎁</span>
                    </div>`;
                wishDisplay.style.display = 'flex';
                return;
            }

            const today = new Date();
            const birth = new Date(birthDate);
            const nextBirthday = getNextBirthday(birthDate);
            const age = calculateAge(birthDate);
            const isBirthday = today.getMonth() === birth.getMonth() && today.getDate() === birth.getDate();
            const daysDiff = getDaysDifference(today, nextBirthday);
            const daysAfterBirthday = getDaysDifference(new Date(today.getFullYear(), birth.getMonth(), birth.getDate()), today);

            let wishes;
            let displayAge = age;

            if (isBirthday) {
                wishes = todayWishes;
                ageDisplay.textContent = `🎉 Happy ${age}th Birthday! 🎉`;
                celebrateWithConfetti();
            } else if (today < nextBirthday) {
                wishes = upcomingWishes;
                displayAge = age + 1;
                ageDisplay.textContent = `${daysDiff} days until your ${displayAge}th birthday! 🎈`;
            } else {
                wishes = pastWishes;
                ageDisplay.textContent = `Age ${age} • ${daysAfterBirthday} days into your amazing year! ✨`;
            }

            ageDisplay.style.display = 'block';
            
            wishDisplay.style.display = 'flex';
            wishDisplay.style.opacity = '0';
            wishDisplay.style.transform = 'scale(0.9)';

            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * wishes.length);
                let personalizedWish = wishes[randomIndex]
                    .replace(/{name}/g, name)
                    .replace(/{age}/g, displayAge)
                    .replace(/{days}/g, isBirthday ? 0 : daysDiff);
                wishDisplay.innerHTML = personalizedWish.split('\n').join('<br>');
                
                if (wishFrom) {
                    wishFromDisplay.textContent = `- With love from ${wishFrom} ❤️`;
                    wishFromDisplay.style.display = 'block';
                }
                
                wishDisplay.style.opacity = '1';
                wishDisplay.style.transform = 'scale(1)';
                wishDisplay.className = 'text-center text-xl font-medium p-6 rounded-xl min-h-[120px] flex items-center justify-center bg-gradient-to-r from-pink-100 to-purple-100 shadow-lg border border-pink-200 transform transition-all duration-500';
            }, 200);
        }

        document.getElementById('generateWish').addEventListener('click', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const nameFromUrl = urlParams.get('name');
            const birthDateFromUrl = urlParams.get('dob');
            const wishFromUrl = urlParams.get('from');
            generateAndDisplayWish(
                nameFromUrl ? decodeURIComponent(nameFromUrl) : "",
                birthDateFromUrl,
                wishFromUrl ? decodeURIComponent(wishFromUrl) : ""
            );
        });

        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const nameFromUrl = urlParams.get('name');
            const birthDateFromUrl = urlParams.get('dob');
            const wishFromUrl = urlParams.get('from');
            if (nameFromUrl && birthDateFromUrl) {
                generateAndDisplayWish(
                    decodeURIComponent(nameFromUrl),
                    birthDateFromUrl,
                    wishFromUrl ? decodeURIComponent(wishFromUrl) : ""
                );
            }
        });

        function celebrateWithConfetti() {
            const count = 200;
            const defaults = {
                origin: { y: 0.7 },
                spread: 360,
                ticks: 100,
                gravity: 0.5,
                decay: 0.94,
                startVelocity: 30
            };

            function fire(particleRatio, opts) {
                confetti({
                    ...defaults,
                    ...opts,
                    particleCount: Math.floor(count * particleRatio)
                });
            }

            fire(0.25, {
                spread: 26,
                startVelocity: 55,
            });
            fire(0.2, {
                spread: 60,
            });
            fire(0.35, {
                spread: 100,
                decay: 0.91,
                scalar: 0.8
            });
            fire(0.1, {
                spread: 120,
                startVelocity: 25,
                decay: 0.92,
                scalar: 1.2
            });
            fire(0.1, {
                spread: 120,
                startVelocity: 45,
            });
        }
    </script>
</body>
</html>